# PR: æ–°å¢æ™ºèƒ½æ’åºæœç´¢APIç«¯ç‚¹

## ğŸ“‹ æ¦‚è¿°

æœ¬PRåœ¨rankæ¨¡å—ä¸­æ–°å¢äº†ä¸€ä¸ªæ™ºèƒ½æ’åºæœç´¢APIç«¯ç‚¹ï¼Œå°†æœç´¢å’Œæ’åºåŠŸèƒ½æ•´åˆåˆ°ä¸€ä¸ªAPIè°ƒç”¨ä¸­ï¼Œæä¾›æ›´æ™ºèƒ½çš„åŒ»ç”Ÿæ¨èæœåŠ¡ã€‚

## ğŸ¯ ä¸»è¦å˜æ›´

### 1. æ–°å¢APIç«¯ç‚¹
- **ç«¯ç‚¹**: `POST /api/v1/rank/search-rank`
- **åŠŸèƒ½**: æœç´¢åŒ»ç”Ÿå¹¶é€šè¿‡rankerè¿›è¡Œæ™ºèƒ½æ’åº
- **è¿”å›æ ¼å¼**: ä¸ç°æœ‰search APIä¿æŒä¸€è‡´

### 2. æ–°å¢æ•°æ®æ¨¡å‹
åœ¨ `app/models/schemas.py` ä¸­æ·»åŠ äº†æ–°çš„è¯·æ±‚æ¨¡å‹ï¼š
```python
class FrontendRankSearchRequest(BaseModel):
    specialty: Optional[str] = None
    insurance: Optional[str] = None
    location: Optional[str] = None
    userinput: Optional[str] = None
```

### 3. æ ¸å¿ƒåŠŸèƒ½å®ç°
åœ¨ `app/api/v1/rank.py` ä¸­å®ç°äº†ï¼š
- `search_and_rank_doctors()`: ä¸»è¦APIå¤„ç†å‡½æ•°
- `parse_location()`: ä½ç½®è§£æåŠŸèƒ½
- `convert_to_doctor_hits()`: æ•°æ®æ ¼å¼è½¬æ¢
- `convert_to_frontend_format()`: æ’åºç»“æœè½¬æ¢

## ğŸ”„ å¤„ç†æµç¨‹

1. **æœç´¢é˜¶æ®µ**: é€šè¿‡BigQueryæœç´¢åŸºç¡€åŒ»ç”Ÿåˆ—è¡¨
2. **è½¬æ¢é˜¶æ®µ**: å°†DoctorOutè½¬æ¢ä¸ºDoctorHitæ ¼å¼
3. **æ’åºé˜¶æ®µ**: è°ƒç”¨ç°æœ‰rank_candidateså‡½æ•°è¿›è¡Œæ™ºèƒ½æ’åº
4. **è¿”å›é˜¶æ®µ**: è½¬æ¢å›å‰ç«¯æ ¼å¼å¹¶ä¿æŒæ’åºé¡ºåº

## ğŸ“Š APIè§„æ ¼

### è¯·æ±‚æ ¼å¼
```json
{
  "specialty": "string",     // åŒ»ç”Ÿä¸“ç§‘
  "insurance": "string",     // ä¿é™©è®¡åˆ’
  "location": "string",      // ä½ç½®ä¿¡æ¯
  "userinput": "string"      // ç”¨æˆ·æ–‡æœ¬è¾“å…¥
}
```

### å“åº”æ ¼å¼
```json
{
  "search_query": "string",
  "total_results": 123,
  "doctors": [
    {
      "npi": "string",
      "first_name": "string",
      "last_name": "string",
      "primary_specialty": "string",
      // ... å…¶ä»–DoctorOutå­—æ®µ
    }
  ]
}
```

## âœ… ç‰¹æ€§

- **æ™ºèƒ½æ’åº**: åˆ©ç”¨ç°æœ‰rankerçš„AIèƒ½åŠ›è¿›è¡Œä¸ªæ€§åŒ–æ¨è
- **æ•°æ®å…¼å®¹**: è¿”å›æ ¼å¼ä¸ç°æœ‰search APIå®Œå…¨ä¸€è‡´
- **æ¨¡å—åŒ–è®¾è®¡**: ä¿æŒæœç´¢å’Œæ’åºé€»è¾‘çš„åˆ†ç¦»
- **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰APIçš„æ­£å¸¸ä½¿ç”¨
- **æ‰©å±•æ€§**: å¯è½»æ¾æ·»åŠ æ›´å¤šæ’åºå› å­

## ğŸš€ ä½¿ç”¨åœºæ™¯

å‰ç«¯å¯ä»¥é€šè¿‡è°ƒç”¨æ­¤APIè·å¾—ï¼š
1. åŸºäºä¸“ç§‘çš„åŸºç¡€æœç´¢
2. è€ƒè™‘ä¿é™©å’Œä½ç½®çš„æ™ºèƒ½æ’åº
3. ç»“åˆç”¨æˆ·æ–‡æœ¬è¾“å…¥çš„ä¸ªæ€§åŒ–æ¨è

## ğŸ“ æ³¨æ„äº‹é¡¹

- ä½ç½®è§£æåŠŸèƒ½ç›®å‰ä½¿ç”¨é»˜è®¤å€¼ï¼Œåç»­å¯é›†æˆåœ°ç†ç¼–ç æœåŠ¡
- æœç´¢å‚æ•°(min_experience, has_certification, limit)ä½¿ç”¨å›ºå®šé»˜è®¤å€¼
- ä¿æŒä¸ç°æœ‰APIæ¶æ„çš„ä¸€è‡´æ€§

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `app/api/v1/rank.py` - æ–°å¢APIç«¯ç‚¹å®ç°
- `app/models/schemas.py` - æ–°å¢æ•°æ®æ¨¡å‹
- `app/services/ranker.py` - ç°æœ‰æ’åºæœåŠ¡
- `app/services/bq_doctor_service.py` - ç°æœ‰æœç´¢æœåŠ¡
